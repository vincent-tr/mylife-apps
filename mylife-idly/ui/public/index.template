<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <title>MyLife Idly</title>
  <style>
    html {
      height:100%;
      margin: 0;
      padding: 0;
    }
    body {
      height:100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      position: relative;
    }
    iframe {
      border: 0;
      width: 100vw;
      height: 100vh;
      display: block;
      position: fixed;
      top:0; left:0;
    }
    #hint {
      position:fixed;
      left:12px;
      bottom:12px;
      padding:6px 10px;
      background:rgba(0,0,0,0.5);
      color:#fff;
      font-family: sans-serif;
      font-size:14px;
      border-radius:6px;
      z-index:9999;
      pointer-events:none;
      opacity:0.6;
      transition: opacity 0.3s ease;
    }
    #hint.hidden {
      opacity:0;
    }
  </style>
</head>
<body>
  <iframe id="frame" src="/slideshow" sandbox="allow-same-origin allow-scripts allow-forms"></iframe>
  <div id="hint">Tap to open controls</div>

  <script>
    (function() {
      var IDLE_TIMEOUT = 3000; // 15000; // 15 seconds
      var frame = document.getElementById('frame');
      var hint = document.getElementById('hint');
      var idleTimer = null;
      var current = 'slideshow'; // 'slideshow' or 'home'

      function showHome() {
        if (current !== 'home') {
          // Load the control UI in the iframe
          frame.src = '{{target}}';
          current = 'home';
        }
        // Hide hint when active (home mode)
        hint.classList.add('hidden');
      }

      function showSlideshow() {
        if (current !== 'slideshow') {
          frame.src = '/slideshow';
          current = 'slideshow';
        }
        // Show hint when idle (slideshow mode)
        hint.classList.remove('hidden');
      }

      function resetIdleTimer() {
        if (idleTimer) {
          clearTimeout(idleTimer);
        }
        // If user interacted, wait IDLE_TIMEOUT and go back to slideshow
        idleTimer = setTimeout(function() {
          showSlideshow();
        }, IDLE_TIMEOUT);
      }

      // When user touches or clicks anywhere: show home and reset idle
      function onUserActivity(e) {
        // avoid focusing elements inside iframe repeatedly
        showHome();
        resetIdleTimer();
      }

      // Listen for basic user activity events
      window.addEventListener('keydown', onUserActivity, false);
      window.addEventListener('mousedown', onUserActivity, false);
      window.addEventListener('touchstart', onUserActivity, false);

      // Also if the iframe navigates to something else on its own (like clicking inside),
      // we still want to start the idle timer if user is active:
      frame.addEventListener('load', function() {
        // If the iframe is the home app, start the idle timer so it returns later
        if (current === 'home') {
          resetIdleTimer();
        }
      });

      // initialize idle countdown immediately
      resetIdleTimer();

      // If the home app sends a message to return to the slideshow,
      // this postMessage handler will respond accordingly.
      window.addEventListener('message', function(evt) {
        if (evt && evt.data === 'idly:show-slideshow') {
          showSlideshow();
        }
      }, false);
    })();
  </script>
</body>
</html>
